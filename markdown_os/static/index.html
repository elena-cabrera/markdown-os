<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Markdown-OS</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg" />
    <script>
      (() => {
        const THEME_KEY = "markdown-os-theme";
        const VALID_THEME_IDS = new Set([
          "light",
          "dark",
          "dracula",
          "nord-light",
          "nord-dark",
          "lofi",
        ]);
        const root = document.documentElement;
        root.classList.add("loading");

        let savedTheme = null;
        try {
          savedTheme = window.localStorage.getItem(THEME_KEY);
        } catch (error) {
          savedTheme = null;
        }

        const nextTheme = VALID_THEME_IDS.has(savedTheme)
          ? savedTheme
          : window.matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light";
        root.setAttribute("data-theme", nextTheme);
      })();
    </script>
    <link rel="stylesheet" href="/static/css/styles.css" />
    <link rel="stylesheet" href="/static/css/themes.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.css"
      crossorigin="anonymous"
    />
    <link
      id="highlight-theme"
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/katex@0.16.21/dist/katex.min.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/svg-pan-zoom@3.6.1/dist/svg-pan-zoom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  </head>
  <body>
    <div id="app-loading" class="loading-banner">Loading markdown document...</div>
    <div class="container hidden" id="app-container">
      <aside id="sidebar">
        <div id="file-tree-container" class="hidden">
          <button
            id="file-tree-toggle"
            class="sidebar-section-toggle"
            type="button"
            aria-expanded="true"
          >
            <svg
              class="toggle-chevron"
              width="12"
              height="12"
              viewBox="0 0 12 12"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <polyline points="4 2 8 6 4 10"></polyline>
            </svg>
            <span>Files</span>
          </button>
          <div id="file-tree-collapsible" class="sidebar-collapsible">
            <div class="sidebar-header">
              <input
                type="text"
                id="file-tree-search"
                placeholder="Search files..."
                class="file-tree-search"
                aria-label="Search files"
              />
            </div>
            <nav id="file-tree" role="tree"></nav>
          </div>
        </div>

        <div id="toc-container">
          <h3>Contents</h3>
          <nav id="toc" role="navigation"></nav>
        </div>
      </aside>

      <main id="main-content">
        <div class="tab-nav">
          <div
            id="top-toolbar-actions"
            class="top-toolbar-actions"
            role="toolbar"
            aria-label="History controls"
          ></div>
          <div id="current-file-path" class="current-file-path hidden">
            <span id="current-file-text"></span>
          </div>
          <div class="tab-controls">
            <div class="theme-dropdown" id="theme-dropdown">
              <button
                class="theme-dropdown-toggle"
                id="theme-dropdown-toggle"
                type="button"
                aria-label="Select theme"
                aria-haspopup="listbox"
                aria-expanded="false"
              >
                <span class="theme-dots" id="theme-dots"></span>
                <svg
                  class="dropdown-chevron"
                  xmlns="http://www.w3.org/2000/svg"
                  width="12"
                  height="12"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2.4"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  aria-hidden="true"
                >
                  <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
              </button>
              <ul
                class="theme-dropdown-menu"
                id="theme-dropdown-menu"
                role="listbox"
                aria-label="Theme selection"
                hidden
              ></ul>
            </div>
            <span id="save-status" aria-live="polite">Idle</span>
          </div>
        </div>

        <div id="file-tabs-bar" class="file-tabs-bar hidden" role="tablist" aria-label="Open files"></div>

        <div class="view-area">
          <section id="wysiwyg-shell" class="wysiwyg-shell">
            <div id="wysiwyg-container" class="wysiwyg-container">
              <div id="wysiwyg-editor" aria-label="Markdown editor"></div>
            </div>
            <div id="wysiwyg-toolbar" class="wysiwyg-toolbar" role="toolbar" aria-label="Formatting"></div>
          </section>

          <div id="empty-state" class="empty-state hidden">
            <div class="empty-state-content">
              <h2 class="empty-state-title">No file selected</h2>
              <p class="empty-state-subtitle">Select a file from the sidebar to open it.</p>
            </div>
          </div>

          <div id="content-loading" class="content-loading-overlay hidden" aria-hidden="true">
            <div class="content-loading-spinner"></div>
          </div>
        </div>
      </main>
    </div>

    <div id="conflict-overlay" class="modal-overlay hidden"></div>
    <div id="conflict-modal" class="modal hidden" role="dialog" aria-modal="true">
      <div class="modal-content">
        <h3 class="modal-title">File Modified Externally</h3>
        <p class="modal-message">
          This file was changed externally and you have unsaved changes in the editor. What
          would you like to do?
        </p>
        <div class="modal-actions">
          <button id="conflict-save" class="btn btn-primary" type="button">Save My Changes</button>
          <button id="conflict-discard" class="btn btn-secondary" type="button">
            Discard My Changes
          </button>
          <button id="conflict-cancel" class="btn btn-tertiary" type="button">Cancel</button>
        </div>
        <p class="modal-hint">Press ESC or click outside to cancel</p>
      </div>
    </div>
    <div id="mermaid-fullscreen-overlay" class="modal-overlay hidden"></div>
    <div
      id="mermaid-fullscreen-modal"
      class="mermaid-fullscreen-modal hidden"
      role="dialog"
      aria-modal="true"
      aria-label="Fullscreen diagram viewer"
    >
      <div class="mermaid-fullscreen-toolbar">
        <button
          id="mermaid-fullscreen-close"
          class="mermaid-fullscreen-btn mermaid-fullscreen-close-btn"
          type="button"
          title="Close (ESC)"
        >
          ✕
        </button>
      </div>
      <div class="mermaid-fullscreen-canvas">
        <div id="mermaid-fullscreen-content" class="mermaid-fullscreen-content"></div>
        <div class="mermaid-zoom-controls">
          <button id="mermaid-zoom-in" class="mermaid-fullscreen-btn" type="button" title="Zoom in">
            +
          </button>
          <button
            id="mermaid-zoom-reset"
            class="mermaid-fullscreen-btn"
            type="button"
            title="Reset view"
          >
            ↻
          </button>
          <button
            id="mermaid-zoom-out"
            class="mermaid-fullscreen-btn"
            type="button"
            title="Zoom out"
          >
            −
          </button>
        </div>
      </div>
    </div>

    <div id="close-tab-overlay" class="modal-overlay hidden"></div>
    <div id="close-tab-modal" class="modal hidden" role="dialog" aria-modal="true">
      <div class="modal-content">
        <h3 class="modal-title">Unsaved Changes</h3>
        <p id="close-tab-message" class="modal-message"></p>
        <div class="modal-actions">
          <button id="close-tab-save" class="btn btn-primary" type="button">Save &amp; Close</button>
          <button id="close-tab-discard" class="btn btn-secondary" type="button">
            Discard &amp; Close
          </button>
          <button id="close-tab-cancel" class="btn btn-tertiary" type="button">Cancel</button>
        </div>
        <p class="modal-hint">Press ESC or click outside to cancel</p>
      </div>
    </div>

    <script src="/static/js/vendor/tiptap-bundle.min.js"></script>
    <script src="/static/js/theme.js"></script>
    <script src="/static/js/websocket.js"></script>
    <script src="/static/js/toc.js"></script>
    <script src="/static/js/file-tree.js"></script>
    <script src="/static/js/wysiwyg.js"></script>
    <script src="/static/js/wysiwyg-toolbar.js"></script>
    <script src="/static/js/tabs.js"></script>
    <script src="/static/js/editor.js"></script>
  </body>
</html>
