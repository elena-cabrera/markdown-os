<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Markdown-OS demo</title>
  <link rel="stylesheet" href="../markdown_os/static/css/styles.css" />
  <link rel="stylesheet" href="../markdown_os/static/css/themes.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css" crossorigin="anonymous" />
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <style>
    /* Demo-only: no loading banner, container always visible */
    .loading-banner { display: none !important; }
    #app-container { display: flex !important; }
    html, body { overflow: auto; height: auto; min-height: 100%; }
    .container { height: 560px; min-height: 560px; }
    /* Demo: no actions on click, but keep pointer + hover */
    .theme-dropdown-toggle, .file-tab, .file-tab-close, .tree-folder-header, .tree-file-link, .history-button, .toolbar-button, .format-menu-item, #toc a, .copy-button, .block-edit-trigger, .mermaid-fullscreen-trigger, .mermaid-zoom-btn { cursor: pointer; }
    /* Preview content: same typography as #wysiwyg-editor */
    #demo-preview { color: var(--editor-text); line-height: 1.7; font-size: 16px; }
    #demo-preview p { margin: 0 0 0.85em; }
    #demo-preview h1, #demo-preview h2, #demo-preview h3, #demo-preview h4 { scroll-margin-top: 14px; }
    #demo-preview pre { margin: 14px 0 20px; }
    #demo-preview table { width: 100%; border-collapse: collapse; margin: 16px 0 20px; font-size: 15px; }
    #demo-preview th, #demo-preview td { border: 1px solid var(--table-border); padding: 9px 14px; }
    #demo-preview th { background: var(--table-header-bg); color: var(--table-header-text); font-weight: 600; }
    #demo-preview tbody tr:nth-child(even) { background: var(--table-row-alt-bg); }
    #demo-preview code { font-family: ui-monospace, monospace; }
  </style>
</head>
<body>
  <div id="app-loading" class="loading-banner">Loading...</div>
  <div class="container" id="app-container">
    <aside id="sidebar">
      <div id="file-tree-container">
        <button id="file-tree-toggle" class="sidebar-section-toggle" type="button" aria-expanded="true">
          <svg class="toggle-chevron" width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 2 8 6 4 10"></polyline></svg>
          <span>Files</span>
        </button>
        <div id="file-tree-collapsible" class="sidebar-collapsible">
          <div class="sidebar-header">
            <input type="text" id="file-tree-search" placeholder="Search files..." class="file-tree-search" aria-label="Search files" />
          </div>
          <nav id="file-tree" role="tree">
            <ul class="tree-root">
              <li class="tree-file"><button type="button" class="tree-file-link" data-path="README.md">README.md</button></li>
              <li class="tree-file"><button type="button" class="tree-file-link" data-path="CLAUDE.md">CLAUDE.md</button></li>
              <li class="tree-folder">
                <button type="button" class="tree-folder-header" data-path="docs" aria-expanded="true">
                  <span class="folder-icon">▼</span>
                  <span class="folder-name">docs</span>
                </button>
                <ul class="tree-children">
                  <li class="tree-file"><button type="button" class="tree-file-link" data-path="docs/features/multi-user.md">multi-user.md</button></li>
                  <li class="tree-file"><button type="button" class="tree-file-link active" data-path="docs/roadmap.md">roadmap.md</button></li>
                </ul>
              </li>
            </ul>
          </nav>
        </div>
      </div>
      <div id="toc-container">
        <h3>Contents</h3>
        <nav id="toc" role="navigation"></nav>
      </div>
    </aside>

    <main id="main-content">
      <div class="tab-nav">
        <div class="undo-redo-group" aria-label="Edit history controls">
          <button type="button" class="history-button" title="Undo" aria-label="Undo">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M3 8h12a6 6 0 0 1 0 12h-4"/><path d="m7 4l-1.154.877C3.95 6.318 3 7.039 3 8s.949 1.682 2.846 3.124L7 12"/></g></svg>
          </button>
          <button type="button" class="history-button" title="Redo" aria-label="Redo">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="16" height="16"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M21 8H9a6 6 0 0 0 0 12h4"/><path d="m17 4l1.154.877C20.05 6.318 21 7.039 21 8s-.949 1.682-2.846 3.124L17 12"/></g></svg>
          </button>
        </div>
        <div id="current-file-path" class="current-file-path">
          <span id="current-file-text">docs/roadmap.md</span>
        </div>
        <div class="tab-controls">
          <div class="theme-dropdown" id="theme-dropdown">
            <button class="theme-dropdown-toggle" type="button" aria-label="Select theme (current: Default Light)" aria-haspopup="listbox" aria-expanded="false" title="Theme: Default Light">
              <span class="theme-dots" id="theme-dots">
                <span class="theme-dot" style="background:#f7f8fa"></span>
                <span class="theme-dot" style="background:#17233b"></span>
                <span class="theme-dot" style="background:#2563eb"></span>
              </span>
              <svg class="dropdown-chevron" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.4" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
            </button>
            <ul class="theme-dropdown-menu" id="theme-dropdown-menu" role="listbox" hidden></ul>
          </div>
          <span id="save-status" class="is-saved" aria-live="polite">Saved</span>
        </div>
      </div>

      <div id="file-tabs-bar" class="file-tabs-bar" role="tablist" aria-label="Open files">
        <button type="button" class="file-tab" role="tab"><span class="file-tab-name">README.md</span><span class="file-tab-close" role="button" aria-label="Close README.md" title="Close tab">×</span></button>
        <button type="button" class="file-tab" role="tab"><span class="file-tab-name">CLAUDE.md</span><span class="file-tab-close" role="button" aria-label="Close CLAUDE.md" title="Close tab">×</span></button>
        <button type="button" class="file-tab active" role="tab"><span class="file-tab-name">docs/roadmap.md</span><span class="file-tab-close" role="button" aria-label="Close docs/roadmap.md" title="Close tab">×</span></button>
        <button type="button" class="file-tab" role="tab"><span class="file-tab-name">docs/features/multi-user.md</span><span class="file-tab-close" role="button" aria-label="Close docs/features/multi-user.md" title="Close tab">×</span></button>
      </div>

      <div class="view-area">
        <section id="editor-container" class="view active">
          <div class="wysiwyg-wrapper">
            <div id="demo-preview" class="demo-preview-content"></div>
          </div>
        </section>

        <div id="floating-toolbar" class="floating-toolbar" role="toolbar" aria-label="Formatting toolbar">
          <div class="toolbar-group">
            <button class="toolbar-button" type="button" data-command="bold" title="Bold (Ctrl+B)" aria-label="Bold">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"><path d="M5 6c0-1.414 0-2.121.44-2.56C5.878 3 6.585 3 8 3h4.579C15.02 3 17 5.015 17 7.5S15.02 12 12.579 12H5z" clip-rule="evenodd"/><path d="M12.429 12h1.238C16.06 12 18 14.015 18 16.5S16.06 21 13.667 21H8c-1.414 0-2.121 0-2.56-.44C5 20.122 5 19.415 5 18v-6"/></g></svg>
            </button>
            <button class="toolbar-button" type="button" data-command="italic" title="Italic (Ctrl+I)" aria-label="Italic">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5" d="M12 4h7M8 20l8-16M5 20h7"/></svg>
            </button>
            <button class="toolbar-button" type="button" data-command="strike" title="Strikethrough (Ctrl+Shift+X)" aria-label="Strikethrough">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"><path stroke-linejoin="round" d="M4 12h16"/><path d="M17.5 7.667C17.5 5.089 15.038 3 12 3S6.5 5.09 6.5 7.667c0 .486.053.93.167 1.333M6 16.333C6 18.911 8.686 21 12 21s6-1.333 6-4.667c0-2.393-1.03-3.755-3.092-4.333"/></g></svg>
            </button>
          </div>
          <div class="toolbar-divider" aria-hidden="true"></div>
          <div class="toolbar-group">
            <button class="toolbar-button" type="button" data-command="h1" title="Heading 1 (Ctrl+Alt+1)" aria-label="Heading 1">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 5v14M14 5v14m3 0h1.5m1.5 0h-1.5m0 0v-8L17 12M4 12h10"/></svg>
            </button>
            <button class="toolbar-button" type="button" data-command="h2" title="Heading 2 (Ctrl+Alt+2)" aria-label="Heading 2">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3.5 5v14m10-14v14m7 0h-4v-.31c0-.438 0-.657.087-.852c.086-.194.249-.34.575-.634l2.605-2.344c.467-.42.733-1.018.733-1.646V13a2 2 0 1 0-4 0v.4M3.5 12h10"/></svg>
            </button>
            <button class="toolbar-button" type="button" data-command="h3" title="Heading 3 (Ctrl+Alt+3)" aria-label="Heading 3">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3.5 5v14m10-14v14m3-2a2 2 0 1 0 2-2a2 2 0 1 0-2-2m-13-1h10"/></svg>
            </button>
          </div>
          <div class="toolbar-divider" aria-hidden="true"></div>
          <div class="toolbar-group">
            <button class="toolbar-button" type="button" data-command="bulletList" title="Bulleted list (Ctrl+Shift+8)" aria-label="Bulleted list">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round"><path stroke-width="1.5" d="M8 5h12"/><path stroke-linejoin="round" stroke-width="2" d="M4 5h.009M4 12h.009M4 19h.009"/><path stroke-width="1.5" d="M8 12h12M8 19h12"/></g></svg>
            </button>
            <button class="toolbar-button" type="button" data-command="orderedList" title="Numbered list (Ctrl+Shift+7)" aria-label="Numbered list">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"><path d="M11 6h10m-10 6h10m-10 6h10"/><path stroke-linejoin="round" d="M3 15h1.5c.279 0 .418 0 .534.023a1.2 1.2 0 0 1 .943.943C6 16.082 6 16.22 6 16.5s0 .418-.023.534a1.2 1.2 0 0 1-.943.943C4.918 18 4.78 18 4.5 18s-.418 0-.534.023a1.2 1.2 0 0 0-.943.943C3 19.082 3 19.22 3 19.5v.9c0 .283 0 .424.088.512s.23.088.512.088H6M3 3h1.2a.3.3 0 0 1 .3.3V9m0 0H3m1.5 0H6"/></g></svg>
            </button>
            <button class="toolbar-button" type="button" data-command="taskList" title="Task list" aria-label="Task list">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"><path d="M11 6h10m-10 6h10m-10 6h10"/><path stroke-linejoin="round" d="M3 7.393S4 8.045 4.5 9C4.5 9 6 5.25 8 4M3 18.393S4 19.045 4.5 20c0 0 1.5-3.75 3.5-5"/></g></svg>
            </button>
            <button class="toolbar-button" type="button" data-command="codeBlock" title="Code block" aria-label="Code block">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="m16 10l1.227 1.057c.515.445.773.667.773.943s-.258.498-.773.943L16 14m-8-4l-1.227 1.057C6.258 11.502 6 11.724 6 12s.258.498.773.943L8 14m5-5l-2 6"/><path d="M2.5 12c0-4.478 0-6.718 1.391-8.109S7.521 2.5 12 2.5c4.478 0 6.718 0 8.109 1.391S21.5 7.521 21.5 12c0 4.478 0 6.718-1.391 8.109S16.479 21.5 12 21.5c-4.478 0-6.718 0-8.109-1.391S2.5 16.479 2.5 12Z"/></g></svg>
            </button>
            <button class="toolbar-button" type="button" data-command="link" title="Link (Ctrl+K)" aria-label="Link">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-width="1.5"><path d="M10 13.229q.213.349.504.654a3.56 3.56 0 0 0 4.454.59q.391-.24.73-.59l3.239-3.372c1.43-1.49 1.43-3.904 0-5.394a3.564 3.564 0 0 0-5.183 0l-.714.743"/><path d="m10.97 18.14l-.713.743a3.564 3.564 0 0 1-5.184 0c-1.43-1.49-1.43-3.905 0-5.394l3.24-3.372a3.564 3.564 0 0 1 5.183 0q.291.305.504.654"/></g></svg>
            </button>
          </div>
          <div class="toolbar-divider" aria-hidden="true"></div>
          <div class="toolbar-group format-group">
            <button class="toolbar-button toolbar-button-label" type="button" aria-haspopup="menu" aria-expanded="false" title="Insert block">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M3.891 20.109C2.5 18.717 2.5 16.479 2.5 12c0-4.478 0-6.718 1.391-8.109S7.521 2.5 12 2.5c4.478 0 6.718 0 8.109 1.391S21.5 7.521 21.5 12c0 4.478 0 6.718-1.391 8.109S16.479 21.5 12 21.5c-4.478 0-6.718 0-8.109-1.391"/><path d="M2.5 9h19m-19 4h19m-19 4h19"/><path stroke-linecap="round" d="M12 21.5V9"/></g></svg>
              <span>Format</span>
            </button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
(function () {
  const previewEl = document.getElementById('demo-preview');
  const tocEl = document.getElementById('toc');
  if (!previewEl || !tocEl) return;

  const demoMd = `# Markdown-OS Showcase

Welcome to **Markdown-OS**. This file demonstrates editor capabilities.

## Quick Start

1. Switch between **Edit** and **Preview** tabs.
2. Change some text in Edit mode.
3. Wait one second and observe save status updates.

### Notes

The sidebar table of contents is generated from headings. Code blocks include language labels and copy actions.

## Text Formatting

Regular text can be mixed with **bold**, _italic_, \`inline code\`, and ~strikethrough~.

## Headings

### Level 3 Heading

#### Level 4 Heading

Heading depth influences TOC indentation and navigation.

## Code Block

\`\`\`python
from pathlib import Path

def summarize_markdown(path: Path) -> dict[str, int]:
    """Return quick counters for markdown diagnostics."""
    text = path.read_text(encoding="utf-8")
    lines = text.splitlines()
    return {
        "line_count": len(lines),
        "heading_count": sum(1 for line in lines if line.startswith("#")),
    }
\`\`\`

## Mermaid Diagram

\`\`\`mermaid
flowchart TD
    Start([Start]) --> Input[Open markdown file]
    Input --> Edit[Edit content]
    Edit --> Save{Auto-save triggered?}
    Save -->|Yes| Persist[Write to disk]
    Save -->|No| Wait[Keep typing]
    Persist --> Render[Refresh preview]
    Wait --> Edit
    Render --> Done([Done])
\`\`\`

## Table

| Feature | Status | Notes |
| --- | --- | --- |
| Live preview | Enabled | Updates while typing |
| Auto-save | Enabled | Debounced |
| Mermaid | Enabled | Rendered in preview |

## Lists

- Dash item one
- Dash item two
  - Nested child A
  - Nested child B
- Dash item three
`;

  if (window.marked) {
    window.marked.setOptions({ gfm: true, headerIds: true });
    previewEl.innerHTML = window.marked.parse(demoMd);
  }

  // TOC from h2, h3, h4
  const headings = previewEl.querySelectorAll('h2, h3, h4');
  const rootList = document.createElement('ul');
  rootList.className = 'root-list';
  let listStack = [rootList];
  let currentLevel = 1;
  headings.forEach(function (h) {
    const level = parseInt(h.tagName.slice(1), 10);
    const id = h.id || ('h-' + Math.random().toString(36).slice(2));
    if (!h.id) h.id = id;
    const text = h.textContent || '';
    while (level > currentLevel && listStack.length > 0) {
      const nested = document.createElement('ul');
      listStack[listStack.length - 1].appendChild(nested);
      listStack.push(nested);
      currentLevel++;
    }
    while (level < currentLevel && listStack.length > 1) {
      listStack.pop();
      currentLevel--;
    }
    const li = document.createElement('li');
    const a = document.createElement('a');
    a.href = '#' + id;
    a.textContent = text;
    a.addEventListener('click', function (e) { e.preventDefault(); });
    li.appendChild(a);
    listStack[listStack.length - 1].appendChild(li);
    currentLevel = level;
  });
  tocEl.appendChild(rootList);

  // Code blocks: wrap + hljs; mermaid blocks
  const preList = Array.from(previewEl.querySelectorAll('pre > code')).map(function (c) { return c.parentElement; }).filter(Boolean);
  preList.forEach(function (pre) {
    const codeEl = pre.querySelector('code');
    if (!codeEl) return;
    const isMermaid = codeEl.classList.contains('language-mermaid') || codeEl.classList.contains('lang-mermaid');
    if (isMermaid) {
      const container = document.createElement('div');
      container.className = 'mermaid-container';
      const toolbar = document.createElement('div');
      toolbar.className = 'mermaid-inline-toolbar';
      const editBtn = document.createElement('button');
      editBtn.type = 'button';
      editBtn.className = 'block-edit-trigger action-icon-button';
      editBtn.title = 'Edit diagram';
      editBtn.setAttribute('aria-label', 'Edit diagram');
      editBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4 20h4l10.5-10.5a2.1 2.1 0 0 0-3-3L5 17v3z"></path></svg>';
      const fullscreenBtn = document.createElement('button');
      fullscreenBtn.type = 'button';
      fullscreenBtn.className = 'mermaid-fullscreen-trigger action-icon-button';
      fullscreenBtn.title = 'View diagram fullscreen';
      fullscreenBtn.setAttribute('aria-label', 'View diagram fullscreen');
      fullscreenBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M8 3H3v5M21 8V3h-5M16 21h5v-5M3 16v5h5"></path></svg>';
      toolbar.appendChild(editBtn);
      toolbar.appendChild(fullscreenBtn);
      const inner = document.createElement('div');
      inner.className = 'mermaid-canvas';
      const mermaidDiv = document.createElement('div');
      mermaidDiv.className = 'mermaid';
      mermaidDiv.textContent = codeEl.textContent || '';
      inner.appendChild(mermaidDiv);
      container.appendChild(toolbar);
      container.appendChild(inner);
      pre.replaceWith(container);
      return;
    }
    const wrap = document.createElement('div');
    wrap.className = 'code-block';
    const header = document.createElement('div');
    header.className = 'code-block-header';
    const lang = (codeEl.className.match(/language-(\w+)/) || [])[1] || 'text';
    const actions = document.createElement('div');
    actions.className = 'code-block-actions';
    const editBtn = document.createElement('button');
    editBtn.type = 'button';
    editBtn.className = 'block-edit-trigger action-icon-button';
    editBtn.title = 'Edit code block';
    editBtn.setAttribute('aria-label', 'Edit code block');
    editBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M4 20h4l10.5-10.5a2.1 2.1 0 0 0-3-3L5 17v3z"></path></svg>';
    const copyBtn = document.createElement('button');
    copyBtn.type = 'button';
    copyBtn.className = 'copy-button action-icon-button';
    copyBtn.title = 'Copy code';
    copyBtn.setAttribute('aria-label', 'Copy code');
    copyBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="9" y="9" width="11" height="11" rx="2"></rect><path d="M5 15V6a2 2 0 0 1 2-2h9"></path></svg>';
    actions.appendChild(editBtn);
    actions.appendChild(copyBtn);
    header.innerHTML = '<span class="code-language-label">' + lang + '</span>';
    header.appendChild(actions);
    const content = document.createElement('div');
    content.className = 'code-block-content';
    const parent = pre.parentElement;
    parent.replaceChild(wrap, pre);
    wrap.appendChild(header);
    wrap.appendChild(content);
    content.appendChild(pre);
    if (window.hljs && !codeEl.classList.contains('hljs')) {
      window.hljs.highlightElement(codeEl);
    }
  });

  if (window.mermaid) {
    window.mermaid.initialize({ startOnLoad: false, theme: 'default', securityLevel: 'loose' });
    window.mermaid.run({ querySelector: '.mermaid-container .mermaid', suppressErrors: true }).catch(function () {});
  }

})();
  </script>
</body>
</html>
